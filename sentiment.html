<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSentiment | Sentiment Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-container">
            <div class="logo">SS</div>
            <div class="logo-text">SocialSentiment</div>
        </div>
        
        <nav class="nav-menu">
            <div class="nav-item">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                    <span class="nav-tooltip">Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="analytics.html" class="nav-link">
                    <i class="fas fa-chart-pie nav-icon"></i>
                    <span class="nav-text">Analytics</span>
                    <span class="nav-tooltip">Analytics</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="sentiment.html" class="nav-link active">
                    <i class="fas fa-smile nav-icon"></i>
                    <span class="nav-text">Sentiment</span>
                    <span class="nav-tooltip">Sentiment</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="alerts.html" class="nav-link">
                    <i class="fas fa-bell nav-icon"></i>
                    <span class="nav-text">Alerts</span>
                    <span class="nav-tooltip">Alerts</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="settings.html" class="nav-link">
                    <i class="fas fa-cog nav-icon"></i>
                    <span class="nav-text">Settings</span>
                    <span class="nav-tooltip">Settings</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" id="logout-btn">
                    <i class="fas fa-sign-out-alt nav-icon"></i>
                    <span class="nav-text">Logout</span>
                    <span class="nav-tooltip">Logout</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <header class="header">
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" placeholder="Search for posts, mentions, or users...">
            </div>
            
            <div class="user-menu">
                <div class="header-action notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
                <div class="header-action">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="header-action">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="user-profile">
                    <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User" class="user-avatar">
                    <div>
                        <div class="user-name">Sarah Johnson</div>
                        <div class="user-role">Admin</div>
                    </div>
                </div>
            </div>
        </header>

        <h1 class="page-title">
            <i class="fas fa-smile"></i>
            Sentiment Analysis
        </h1>
        <p class="page-subtitle">Detailed sentiment breakdown across all platforms</p>
        
        <!-- Sentiment Overview -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-chart-pie"></i>
                Sentiment Overview
            </h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-smile-beam"></i>
                        Positive Sentiment
                    </div>
                    <div class="stat-value">64%</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 6.2%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-frown-open"></i>
                        Negative Sentiment
                    </div>
                    <div class="stat-value">18%</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i> 2.1%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-meh"></i>
                        Neutral Sentiment
                    </div>
                    <div class="stat-value">18%</div>
                    <div class="stat-change neutral">
                        <i class="fas fa-minus"></i> 0.5%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">
                        <i class="fas fa-comments"></i>
                        Total Mentions
                    </div>
                    <div class="stat-value">12,847</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> 12.5%
                    </div>
                </div>
            </div>
            
            <div class="chart-container" style="height: 300px;">
                <canvas id="sentimentTrendChart"></canvas>
            </div>
        </div>
        
        <!-- Platform Sentiment -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-mobile-alt"></i>
                Platform Sentiment
            </h2>
            
            <div class="analysis-tabs">
                <button class="tab-btn active" data-tab="platform-comparison">Comparison</button>
                <button class="tab-btn" data-tab="platform-details">Details</button>
                <button class="tab-btn" data-tab="platform-trends">Trends</button>
            </div>
            
            <div class="tab-content active" id="platform-comparison-content">
                <div class="chart-container" style="height: 400px;">
                    <canvas id="platformSentimentChart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="platform-details-content">
                <div class="platform-grid">
                    <!-- Facebook Card -->
                    <div class="platform-card">
                        <div class="platform-header">
                            <div class="platform-icon facebook-icon">
                                <i class="fab fa-facebook-f"></i>
                            </div>
                            <div class="platform-name">Facebook</div>
                        </div>
                        <div class="platform-body">
                            <div class="chart-container" style="height: 150px;">
                                <canvas id="facebookSentimentChart"></canvas>
                            </div>
                            <div class="sentiment-distribution">
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color positive-color"></span>
                                        Positive
                                    </div>
                                    <div class="sentiment-value">58%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color neutral-color"></span>
                                        Neutral
                                    </div>
                                    <div class="sentiment-value">30%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color negative-color"></span>
                                        Negative
                                    </div>
                                    <div class="sentiment-value">12%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Twitter Card -->
                    <div class="platform-card">
                        <div class="platform-header">
                            <div class="platform-icon twitter-icon">
                                <i class="fab fa-twitter"></i>
                            </div>
                            <div class="platform-name">Twitter</div>
                        </div>
                        <div class="platform-body">
                            <div class="chart-container" style="height: 150px;">
                                <canvas id="twitterSentimentChart"></canvas>
                            </div>
                            <div class="sentiment-distribution">
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color positive-color"></span>
                                        Positive
                                    </div>
                                    <div class="sentiment-value">62%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color neutral-color"></span>
                                        Neutral
                                    </div>
                                    <div class="sentiment-value">25%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color negative-color"></span>
                                        Negative
                                    </div>
                                    <div class="sentiment-value">13%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instagram Card -->
                    <div class="platform-card">
                        <div class="platform-header">
                            <div class="platform-icon instagram-icon">
                                <i class="fab fa-instagram"></i>
                            </div>
                            <div class="platform-name">Instagram</div>
                        </div>
                        <div class="platform-body">
                            <div class="chart-container" style="height: 150px;">
                                <canvas id="instagramSentimentChart"></canvas>
                            </div>
                            <div class="sentiment-distribution">
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color positive-color"></span>
                                        Positive
                                    </div>
                                    <div class="sentiment-value">72%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color neutral-color"></span>
                                        Neutral
                                    </div>
                                    <div class="sentiment-value">20%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color negative-color"></span>
                                        Negative
                                    </div>
                                    <div class="sentiment-value">8%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- YouTube Card -->
                    <div class="platform-card">
                        <div class="platform-header">
                            <div class="platform-icon youtube-icon">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div class="platform-name">YouTube</div>
                        </div>
                        <div class="platform-body">
                            <div class="chart-container" style="height: 150px;">
                                <canvas id="youtubeSentimentChart"></canvas>
                            </div>
                            <div class="sentiment-distribution">
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color positive-color"></span>
                                        Positive
                                    </div>
                                    <div class="sentiment-value">55%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color neutral-color"></span>
                                        Neutral
                                    </div>
                                    <div class="sentiment-value">35%</div>
                                </div>
                                <div class="sentiment-item">
                                    <div class="sentiment-label">
                                        <span class="sentiment-color negative-color"></span>
                                        Negative
                                    </div>
                                    <div class="sentiment-value">10%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="platform-trends-content">
                <div class="chart-container" style="height: 400px;">
                    <canvas id="platformTrendsChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Sentiment by Topic -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-tags"></i>
                Sentiment by Topic
            </h2>
            
            <div class="analysis-tabs">
                <button class="tab-btn active" data-tab="topic-keywords">Keywords</button>
                <button class="tab-btn" data-tab="topic-categories">Categories</button>
                <button class="tab-btn" data-tab="topic-trends">Trends</button>
            </div>
            
            <div class="tab-content active" id="topic-keywords-content">
                <div class="keyword-cloud">
                    <div class="keyword positive">product (87%)</div>
                    <div class="keyword positive">experience (92%)</div>
                    <div class="keyword positive">quality (89%)</div>
                    <div class="keyword negative">service (35%)</div>
                    <div class="keyword neutral">update (62%)</div>
                    <div class="keyword positive">support (78%)</div>
                    <div class="keyword negative">bug (22%)</div>
                    <div class="keyword positive">feature (85%)</div>
                    <div class="keyword neutral">price (58%)</div>
                    <div class="keyword positive">design (89%)</div>
                    <div class="keyword negative">slow (30%)</div>
                    <div class="keyword positive">fast (88%)</div>
                    <div class="keyword neutral">change (55%)</div>
                    <div class="keyword positive">easy (91%)</div>
                    <div class="keyword negative">difficult (28%)</div>
                </div>
            </div>
            
            <div class="tab-content" id="topic-categories-content">
                <div class="chart-container" style="height: 400px;">
                    <canvas id="topicCategoriesChart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="topic-trends-content">
                <div class="chart-container" style="height: 400px;">
                    <canvas id="topicTrendsChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Recent Sentiment Posts -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-comment-alt"></i>
                Recent Sentiment Posts
            </h2>
            
            <div class="post-list">
                <div class="post-card">
                    <div class="post-header">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="post-avatar">
                        <div>
                            <div class="post-user">Michael Brown</div>
                            <div class="post-meta">
                                <span>2 hours ago</span>
                                <span class="post-platform">
                                    <i class="fab fa-twitter"></i> Twitter
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        Really impressed with the new update! The interface is so much smoother now and the new features are exactly what I needed. Great job team!
                    </div>
                    <div class="post-sentiment positive">
                        <i class="fas fa-smile"></i> Positive (92%)
                    </div>
                </div>
                
                <div class="post-card">
                    <div class="post-header">
                        <img src="https://randomuser.me/api/portraits/women/65.jpg" alt="User" class="post-avatar">
                        <div>
                            <div class="post-user">Jessica Wilson</div>
                            <div class="post-meta">
                                <span>5 hours ago</span>
                                <span class="post-platform">
                                    <i class="fab fa-facebook-f"></i> Facebook
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        The customer service has been terrible lately. I've been waiting for a response to my ticket for over 3 days now. Very disappointed.
                    </div>
                    <div class="post-sentiment negative">
                        <i class="fas fa-frown"></i> Negative (18%)
                    </div>
                </div>
                
                <div class="post-card">
                    <div class="post-header">
                        <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User" class="post-avatar">
                        <div>
                            <div class="post-user">David Miller</div>
                            <div class="post-meta">
                                <span>1 day ago</span>
                                <span class="post-platform">
                                    <i class="fab fa-instagram"></i> Instagram
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        The new pricing plans are interesting. Not sure if I'll upgrade yet but I like that there are more options now. The interface could be more intuitive though.
                    </div>
                    <div class="post-sentiment neutral">
                        <i class="fas fa-meh"></i> Neutral (65%)
                    </div>
                </div>
            </div>
        </div>

        <!-- Analyze Your Own Text -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-comment-dots"></i>
                Analyze Your Own Text
            </h2>
            <form id="sentimentForm" style="margin-bottom: 1.5rem;">
                <div class="form-group">
                    <label for="userText">Enter text to analyze sentiment:</label>
                    <textarea id="userText" class="form-control" rows="3" placeholder="Type your text here..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Analyze Sentiment</button>
            </form>
            <div id="sentimentResult" style="font-size: 1.1rem; font-weight: 500;"></div>
        </div>

        <!-- Analyze Text Sentiment (as you type) -->
        <div class="card">
            <h2 class="card-title">
                <i class="fas fa-comment-dots"></i>
                Analyze Text Sentiment
            </h2>
            <textarea id="sentimentInput" rows="3" class="form-control" placeholder="Type text to analyze..."></textarea>
            <div id="sentimentLiveResult" style="margin-top:1em;font-weight:bold;"></div>
        </div>
    </main>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/script.js"></script>
    <script src="js/profile-sync.js"></script>
    <script>
        // Additional charts for sentiment page
        document.addEventListener('DOMContentLoaded', function() {
            // Sentiment Trend Chart
            const sentimentTrendCtx = document.getElementById('sentimentTrendChart').getContext('2d');
            new Chart(sentimentTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [
                        {
                            label: 'Positive',
                            data: [45, 52, 58, 62, 67, 64],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Neutral',
                            data: [35, 32, 28, 25, 22, 25],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Negative',
                            data: [20, 16, 14, 13, 11, 12],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Platform Sentiment Chart
            const platformSentimentCtx = document.getElementById('platformSentimentChart').getContext('2d');
            new Chart(platformSentimentCtx, {
                type: 'bar',
                data: {
                    labels: ['Facebook', 'Twitter', 'Instagram', 'YouTube'],
                    datasets: [
                        {
                            label: 'Positive',
                            data: [58, 62, 72, 55],
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        },
                        {
                            label: 'Neutral',
                            data: [30, 25, 20, 35],
                            backgroundColor: '#f59e0b',
                            borderRadius: 4
                        },
                        {
                            label: 'Negative',
                            data: [12, 13, 8, 10],
                            backgroundColor: '#ef4444',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Platform Trends Chart
            const platformTrendsCtx = document.getElementById('platformTrendsChart').getContext('2d');
            new Chart(platformTrendsCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [
                        {
                            label: 'Facebook Positive',
                            data: [50, 55, 53, 56, 58, 58],
                            borderColor: '#1877f2',
                            backgroundColor: 'rgba(24, 119, 242, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Twitter Positive',
                            data: [55, 58, 60, 62, 63, 62],
                            borderColor: '#1da1f2',
                            backgroundColor: 'rgba(29, 161, 242, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Instagram Positive',
                            data: [65, 68, 70, 72, 73, 72],
                            borderColor: '#e1306c',
                            backgroundColor: 'rgba(224, 53, 102, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'YouTube Positive',
                            data: [50, 52, 53, 54, 55, 55],
                            borderColor: '#ff0000',
                            backgroundColor: 'rgba(255, 0, 0, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Topic Categories Chart
            const topicCategoriesCtx = document.getElementById('topicCategoriesChart').getContext('2d');
            new Chart(topicCategoriesCtx, {
                type: 'bar',
                data: {
                    labels: ['Product', 'Service', 'Price', 'Features', 'Support', 'Design'],
                    datasets: [
                        {
                            label: 'Positive',
                            data: [85, 35, 40, 82, 78, 89],
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        },
                        {
                            label: 'Neutral',
                            data: [10, 25, 45, 12, 15, 8],
                            backgroundColor: '#f59e0b',
                            borderRadius: 4
                        },
                        {
                            label: 'Negative',
                            data: [5, 40, 15, 6, 7, 3],
                            backgroundColor: '#ef4444',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Platform-specific sentiment charts
            const platformData = {
                facebook: {
                    positive: 58,
                    neutral: 30,
                    negative: 12,
                    color: '#1877f2'
                },
                twitter: {
                    positive: 62,
                    neutral: 25,
                    negative: 13,
                    color: '#1da1f2'
                },
                instagram: {
                    positive: 72,
                    neutral: 20,
                    negative: 8,
                    color: '#e1306c'
                },
                youtube: {
                    positive: 55,
                    neutral: 35,
                    negative: 10,
                    color: '#ff0000'
                }
            };
            
            Object.keys(platformData).forEach(platform => {
                const ctx = document.getElementById(`${platform}SentimentChart`).getContext('2d');
                const data = platformData[platform];
                
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Positive', 'Neutral', 'Negative'],
                        datasets: [{
                            data: [data.positive, data.neutral, data.negative],
                            backgroundColor: [
                                '#10b981',
                                '#f59e0b',
                                '#ef4444'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            });
        });

        // Sentiment analysis form logic
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('sentimentForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const text = document.getElementById('userText').value.trim();
                    const resultDiv = document.getElementById('sentimentResult');
                    resultDiv.textContent = '';
                    if (!text) {
                        resultDiv.textContent = 'Please enter some text.';
                        resultDiv.style.color = '#ef4444';
                        return;
                    }
                    resultDiv.textContent = 'Analyzing...';
                    resultDiv.style.color = '#333';
                    try {
                        const res = await fetch('http://localhost:5001/api/sentiment', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ text })
                        });
                        if (res.ok) {
                            const data = await res.json();
                            let color = '#10b981';
                            if (data.sentiment === 'negative') color = '#ef4444';
                            else if (data.sentiment === 'neutral') color = '#f59e0b';
                            resultDiv.innerHTML = `Sentiment: <span style="color: ${color}">${data.sentiment.toUpperCase()}</span>`;
                        } else {
                            let errorMsg = 'Error analyzing sentiment.';
                            try {
                                const errData = await res.json();
                                if (errData && errData.error) errorMsg += `\n${errData.error}`;
                            } catch {}
                            resultDiv.textContent = errorMsg;
                            resultDiv.style.color = '#ef4444';
                        }
                    } catch (err) {
                        resultDiv.textContent = 'Server error. Please try again.\n' + (err.message || '') + '\nIs the backend running at http://localhost:5001?';
                        resultDiv.style.color = '#ef4444';
                    }
                });
            }
        });

        // Sentiment analysis as you type
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('sentimentInput');
            const resultDiv = document.getElementById('sentimentLiveResult');
            let timeout = null;
            if (input) {
                input.addEventListener('input', function() {
                    clearTimeout(timeout);
                    const text = input.value.trim();
                    if (!text) {
                        resultDiv.textContent = '';
                        return;
                    }
                    resultDiv.textContent = 'Analyzing...';
                    timeout = setTimeout(async () => {
                        try {
                            const res = await fetch('http://localhost:5001/api/sentiment', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ text })
                            });
                            if (res.ok) {
                                const data = await res.json();
                                let color = '#10b981';
                                if (data.sentiment === 'negative') color = '#ef4444';
                                else if (data.sentiment === 'neutral') color = '#f59e0b';
                                resultDiv.innerHTML = `Sentiment: <span style=\"color:${color}\">${data.sentiment.toUpperCase()}</span>`;
                            } else {
                                let errorMsg = 'Error analyzing sentiment.';
                                try {
                                    const errData = await res.json();
                                    if (errData && errData.error) errorMsg += `\n${errData.error}`;
                                } catch {}
                                resultDiv.textContent = errorMsg;
                                resultDiv.style.color = '#ef4444';
                            }
                        } catch (err) {
                            resultDiv.textContent = 'Server error. Please try again.\n' + (err.message || '') + '\nIs the backend running at http://localhost:5001?';
                            resultDiv.style.color = '#ef4444';
                        }
                    }, 400);
                });
            }
        });
    </script>
</body>
</html>